[metadata]
name = "test"
description = """\
This is a test experiment to test dart_wrf.
"""

[environment]
PREFIX = "/mnt/scratch-1/wrf-dart-intro"
WRF_DIR = "/mnt/scratch-1/wrf-dart-intro/WRF"
WRFIO_NCD_LARGE_FILE_SUPPORT = "1"
WRF_CHEM = "1"
EM_CORE = "1"

[directories]
wrf_root = "/mnt/scratch-1/wrf-dart-intro/WRF"
wps_root = "/mnt/scratch-1/wrf-dart-intro/WPS"
dart_root = "/mnt/scratch-1/wrf-dart-intro/DART"
wrfda_root = "/mnt/scratch-1/wrf-dart-intro/WRFDA"


[domain_control]
xy_resolution = [26, 26] # km
xy_size = [60, 60]       # grid points

projection = "lambert"
ref_lat = 26.0
ref_lon = -30.0
truelat1 = 33.0
truelat2 = 33.0
stand_lon = -22.0

[time_control]
# Start-end times for the whole experiment (all assimilation cycles)
start = 2021-09-01T00:00:00Z
end = 2021-09-02T00:00:00Z
# Corresponds to interval_seconds in WRF, but in minutes
boundary_update_interval = 360 # 6h
# Output file interval, in minutes (WRF history_interval)
output_interval = 120
# How often the analysis is run, in minutes
analysis_interval = 720 # 12h


[data]
wps_geog = "/mnt/scratch-1/wrf-dart-intro/data/WPS_GEOG"
meteorology = "/mnt/scratch-1/wrf-dart-intro/data/ERA5_CDS_September_2021"
meteorology_vtable = "Vtable.ERA-interim.pl"

[pertubations.T]
mean = 1
sd = 1
rounds = 5

[pertubations.U]
mean = 1
sd = 4
rounds = 10

[assimilation]
n_members = 4
# Which variables to carry forward from the previous cycle
cycled_variables = [
  'U',
  'V',
  'PH',
  'T',
  'MU',
  'QVAPOR',
  'QCLOUD',
  'QRAIN',
  'QICE',
  'QSNOW',
  'QGRAUP',
  'QNICE',
  'QNRAIN',
  'U10',
  'V10',
  'T2',
  'Q2',
  'PSFC',
  'TSLB',
  'SMOIS',
  'TSK',
]
# Which variables to extract from the WRF output into the statistics files
extract_variables = [
  'U',
  'V',
  'PH',
  'T',
  'MU',
  'QVAPOR',
  'QCLOUD',
  'QRAIN',
  'QICE',
  'QSNOW',
  'QGRAUP',
  'QNICE',
  'QNRAIN',
  'U10',
  'V10',
  'T2',
  'Q2',
  'PSFC',
  'TSLB',
  'SMOIS',
  'TSK',
  'RAINC',
  'RAINNC',
  'GRAUPELNC',
]

[slurm]
partition = "cascadelake"
nodes = 1
ntasks-per-node = 40
cpus-per-task = 1
env_modules = ["mpi/mpich-x86_64", "netCDF/4.9.0-gnu"]

# -- WRF NAMELIST OPTIONS --
[wrf_namelist]

[wrf_namelist.time_control]
input_from_file = true
history_interval = 60
frames_per_outfile = 1
restart = false
restart_interval = 2881
io_form_history = 2
io_form_restart = 102
io_form_input = 2
io_form_boundary = 2
io_form_auxhist2 = 2
debug_level = 0
diag_print = 0

[wrf_namelist.domains]
eta_levels = [
  1.0000,
  0.9980,
  0.9940,
  0.9870,
  0.9750,
  0.9590,
  0.9390,
  0.9160,
  0.8920,
  0.8650,
  0.8350,
  0.8020,
  0.7660,
  0.7270,
  0.6850,
  0.6400,
  0.5920,
  0.5420,
  0.4970,
  0.4565,
  0.4205,
  0.3877,
  0.3582,
  0.3317,
  0.3078,
  0.2863,
  0.2670,
  0.2496,
  0.2329,
  0.2188,
  0.2047,
  0.1906,
  0.1765,
  0.1624,
  0.1483,
  0.1342,
  0.1201,
  0.1060,
  0.0919,
  0.0778,
  0.0657,
  0.0568,
  0.0486,
  0.0409,
  0.0337,
  0.0271,
  0.0209,
  0.0151,
  0.0097,
  0.0047,
  0.0000,
]
time_step = 60
time_step_fract_num = 0
time_step_fract_den = 1
e_vert = 51
num_metgrid_levels = 38
num_metgrid_soil_levels = 4
grid_id = 1
parent_id = 0
i_parent_start = 1
j_parent_start = 1
parent_grid_ratio = 1
parent_time_step_ratio = 1
feedback = 0
smooth_option = 1
p_top_requested = 1500
lagrange_order = 2
interp_type = 2
interp_theta = false
hypsometric_opt = 2
extrap_type = 2
t_extrap_type = 2
use_surface = true
use_levels_below_ground = true
lowest_lev_from_sfc = false
force_sfc_in_vinterp = 1
zap_close_levels = 500


[wrf_namelist.physics]
mp_physics = 8
ra_lw_physics = 4
ra_sw_physics = 4
radt = 10
sf_sfclay_physics = 2
sf_surface_physics = 2
bl_pbl_physics = 2
bldt = 0
cu_physics = 6
cudt = 5
mp_zero_out = 2
mp_zero_out_thresh = 1e-10
isfflx = 1
ifsnow = 0
icloud = 1
surface_input_source = 1
num_soil_layers = 4
o3input = 2
aer_opt = 1
sst_skin = 1


[wrf_namelist.dynamics]
zdamp = [5000, 5000, 5000]
non_hydrostatic = [true]
w_damping = 1
diff_opt = 1
km_opt = 4
damp_opt = 3
dampcoef = [0.2, 0.01, 0.2]
moist_adv_opt = [2, 2]
scalar_adv_opt = [2, 2]
diff_6th_opt = [2, 2]
diff_6th_factor = [0.25, 0.12]
epssm = 0.1

[wrf_namelist.namelist_quilt]
nio_tasks_per_group = 0
nio_groups = 1

[wrf_namelist.bdy_control]
spec_bdy_width = 5
specified = [true]
